---
interface Props {
  title?: string;
  subtitle?: string;
  showScrollIndicator?: boolean;
}

const { 
  title = "Transformamos ideas en experiencias digitales excepcionales",
  subtitle = "Desarrollo de Software, Web, Apps y Marketing Digital",
  showScrollIndicator = true 
} = Astro.props;
---

<section class="hero-section relative min-h-screen flex flex-col pb-5 items-center justify-center overflow-hidden hero-gradient">
  <!-- Animated Background Elements -->
  <div class="absolute inset-0 overflow-hidden pointer-events-none">
    <!-- Gradient Orbs -->
    <div class="orb orb-1 absolute w-[400px] sm:w-[600px] h-[400px] sm:h-[600px] rounded-full bg-cyan-500/10 blur-[100px]"></div>
    <div class="orb orb-2 absolute w-[300px] sm:w-[400px] h-[300px] sm:h-[400px] rounded-full bg-blue-500/15 blur-[80px]"></div>
    <div class="orb orb-3 absolute w-[200px] sm:w-[300px] h-[200px] sm:h-[300px] rounded-full bg-cyan-400/10 blur-[60px]"></div>
    
    <!-- Grid Pattern -->
    <div class="absolute inset-0 bg-[linear-gradient(rgba(0,211,255,0.03)_1px,transparent_1px),linear-gradient(90deg,rgba(0,211,255,0.03)_1px,transparent_1px)] bg-[size:60px_60px]"></div>
    
    <!-- Floating Particles -->
    <div class="particles">
      {Array.from({ length: 20 }).map((_, i) => (
        <div 
          class="particle absolute w-1 h-1 bg-cyan-400/50 rounded-full"
          style={`
            left: ${Math.random() * 100}%;
            top: ${Math.random() * 100}%;
            animation-delay: ${Math.random() * 5}s;
            animation-duration: ${5 + Math.random() * 10}s;
          `}
        />
      ))}
    </div>
  </div>

  <!-- Main Content -->
  <div class="container mx-auto px-4 sm:px-6 lg:px-12 pt-20 sm:pt-24 pb-4 sm:pb-16 relative z-10">
    <div class="grid lg:grid-cols-2 gap-8 sm:gap-12 lg:gap-20 items-center">
      
      <!-- Text Content -->
      <div class="text-center lg:text-left order-2 lg:order-1">
        <!-- Badge -->
        <div class="hero-badge inline-flex items-center gap-2 px-3 py-1.5 sm:px-4 sm:py-2 rounded-full bg-white/5 border border-white/10 backdrop-blur-sm mb-4 sm:mb-8">
          <span class="w-1.5 h-1.5 sm:w-2 sm:h-2 bg-cyan-400 rounded-full animate-pulse"></span>
          <span class="text-white/70 text-xs sm:text-sm font-medium">Agencia Digital en Monterrey, MX</span>
        </div>
        
        <!-- Main Title -->
        <h1 class="hero-title text-3xl sm:text-4xl md:text-5xl lg:text-6xl xl:text-7xl font-montserrat-alt font-light text-white leading-tight mb-4 sm:mb-6">
          <span class="block">Transformamos</span>
          <span class="block mt-0.5 sm:mt-2">
            <span class="gradient-text-animated">ideas</span> en
          </span>
          <span class="block mt-0.5 sm:mt-2">experiencias</span>
          <span class="block mt-0.5 sm:mt-2 text-cyan-400">digitales</span>
        </h1>
        
        <!-- Subtitle -->
        <p class="hero-subtitle text-sm sm:text-lg md:text-xl text-white/60 max-w-xl mx-auto lg:mx-0 mb-5 sm:mb-8 lg:mb-10 leading-relaxed px-0">
          Somos un equipo apasionado de desarrolladores, diseñadores y estrategas comprometidos con crear soluciones que impulsen tu negocio.
        </p>
        
        <!-- CTA Buttons -->
        <div class="hero-cta flex flex-col sm:flex-row gap-3 sm:gap-4 justify-center lg:justify-start relative z-20">
          <a 
            href="#contacto" 
            class="group relative inline-block px-6 sm:px-8 sm:w-fit py-2 sm:py-4 bg-gradient-to-r from-cyan-500 to-blue-500 text-white text-sm sm:text-base font-medium rounded-full overflow-hidden transition-all duration-300 hover:shadow-glow hover:scale-105"
            onclick="typeof window.gtag === 'function' && window.gtag('event', 'click', { event_category: 'CTA', event_label: 'Hero CTA - Solicitar Cotización' })"
          >
            <span class="relative z-10 flex items-center justify-center gap-2">
              Solicitar Cotización
              <svg class="w-5 h-5 transition-transform duration-300 group-hover:translate-x-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
              </svg>
            </span>
            <div class="absolute inset-0 bg-gradient-to-r from-blue-500 to-cyan-500 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
          </a>
          
          <a 
            href="https://wa.me/528136600062?text=¡Hola! Quiero solicitar una cotización para mi proyecto"
            target="_blank"
            rel="noopener"
            onclick="typeof window.trackWhatsAppClick === 'function' && window.trackWhatsAppClick()"
            class="group flex items-center justify-center px-6 sm:px-8 sm:w-fit py-2 sm:py-4 border border-white/20 text-white text-sm sm:text-base font-medium rounded-full backdrop-blur-sm transition-all duration-300 hover:bg-white/10 hover:border-green-500/50"
          >
            <span class="flex items-center justify-center gap-2">
              <svg class="w-5 h-5 text-green-400" fill="currentColor" viewBox="0 0 24 24">
                <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/>
              </svg>
              WhatsApp
            </span>
          </a>
        </div>

        <!-- Trust Indicators -->
        <div class="hero-trust mt-8 sm:mt-12 flex flex-wrap items-center justify-center lg:justify-start gap-3 sm:gap-6 text-white/40 text-xs sm:text-sm">
          <div class="flex items-center gap-2">
            <svg class="w-5 h-5 text-cyan-400" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
            </svg>
            <span>+15 Proyectos</span>
          </div>
          <div class="flex items-center gap-2">
            <svg class="w-5 h-5 text-cyan-400" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
            </svg>
            <span>5+ Años Experiencia</span>
          </div>
          <div class="flex items-center gap-2">
            <svg class="w-5 h-5 text-cyan-400" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
            </svg>
            <span>100% Satisfacción</span>
          </div>
        </div>
      </div>
      
      <!-- Hero Visual -->
      <div class="hero-visual order-1 lg:order-2 relative">
        <div class="relative w-full max-w-lg mx-auto perspective-1000">
          <!-- Floating Laptop Mockup -->
          <div class="laptop-container relative animate-float">
            <!-- Glow Effect -->
            <div class="absolute inset-0 bg-gradient-to-r from-cyan-500/30 to-blue-500/30 blur-3xl rounded-full scale-75 opacity-60"></div>
            
            <!-- Laptop Image -->
            <div class="relative">
              <picture>
                <!-- Mobile: force sm image -->
                <source 
                  media="(max-width: 640px)" 
                  srcset="/img/Laptop-full-sm.webp"
                  type="image/webp"
                />
                <!-- Tablet: use md image -->
                <source 
                  media="(max-width: 1024px)" 
                  srcset="/img/Laptop-full-md.webp"
                  type="image/webp"
                />
                <!-- Desktop: use lg image -->
                <img 
                  src="/img/Laptop-full-md.webp"
                  srcset="/img/Laptop-full-md.webp 800w, /img/Laptop-full-lg.webp 1200w"
                  sizes="(max-width: 1024px) 800px, 600px"
                  alt="Gemini Software - Desarrollo Web y Aplicaciones"
                  class="relative z-10 w-full h-auto drop-shadow-2xl"
                  width="400"
                  height="232"
                  decoding="async"
                  fetchpriority="high"
                />
              </picture>
              
              <!-- Screen Content Animation -->
              <div class="absolute top-[8%] left-[12%] right-[12%] bottom-[25%] overflow-hidden rounded-lg">
                <div class="screen-content w-full h-full bg-gradient-to-br from-dark-blue-500 to-blue-500">
                  <!-- Animated code lines -->
                  <div class="p-4 space-y-2">
                    <div class="h-2 bg-cyan-400/30 rounded w-3/4 animate-pulse"></div>
                    <div class="h-2 bg-white/20 rounded w-1/2 animate-pulse" style="animation-delay: 0.2s"></div>
                    <div class="h-2 bg-cyan-400/20 rounded w-5/6 animate-pulse" style="animation-delay: 0.4s"></div>
                    <div class="h-2 bg-white/10 rounded w-2/3 animate-pulse" style="animation-delay: 0.6s"></div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Floating Elements -->
            <div class="absolute -top-8 -right-8 w-20 h-20 bg-gradient-to-br from-cyan-400 to-blue-500 rounded-2xl flex items-center justify-center shadow-glow animate-float" style="animation-delay: 1s">
              <svg class="w-10 h-10 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4" />
              </svg>
            </div>

            <div class="absolute -bottom-4 -left-4 w-16 h-16 bg-gradient-to-br from-blue-500 to-dark-blue-500 rounded-xl flex items-center justify-center shadow-glow-blue animate-float" style="animation-delay: 2s">
              <svg class="w-8 h-8 text-cyan-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
              </svg>
            </div>

            <div class="absolute top-1/2 -right-12 w-14 h-14 bg-white/10 backdrop-blur-sm rounded-full flex items-center justify-center border border-white/20 animate-float" style="animation-delay: 0.5s">
              <svg class="w-7 h-7 text-cyan-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z" />
              </svg>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Scroll Indicator -->
  {showScrollIndicator && (
    <div class="scroll-indicator bottom-8 flex flex-col items-center gap-2">
      <span class="text-white/40 text-xs uppercase tracking-widest">Scroll</span>
      <div class="w-6 h-10 border-2 border-white/20 rounded-full flex justify-center pt-2">
        <div class="w-1 h-2 bg-cyan-400 rounded-full animate-bounce"></div>
      </div>
    </div>
  )}
</section>

<script>
  import { gsap } from 'gsap';
  import { ScrollTrigger } from 'gsap/ScrollTrigger';
  
  gsap.registerPlugin(ScrollTrigger);
  
  // Reduce forced reflows by batching reads/writes
  gsap.config({ 
    force3D: true,
    nullTargetWarn: false,
  });
  
  // Hero animations on load - Use requestIdleCallback to not block LCP
  const initHeroAnimations = () => {
    // Skip animations on slow connections or reduced motion preference
    if ('connection' in navigator && (navigator as any).connection?.saveData) return;
    if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) return;
    
    const tl = gsap.timeline({ defaults: { ease: 'power3.out' } });
    
    // Batch animations to reduce reflows
    tl.from('.hero-badge', { opacity: 0, y: 30, duration: 0.6 })
      .from('.hero-title span', { opacity: 0, y: 50, stagger: 0.1, duration: 0.6 }, '-=0.4')
      .from('.hero-subtitle', { opacity: 0, y: 30, duration: 0.6 }, '-=0.4')
      .from('.hero-trust > div', { opacity: 0, y: 20, stagger: 0.08, duration: 0.4 }, '-=0.3');
  };
  
  // Defer parallax until after initial render - reduces forced reflows
  const initParallax = () => {
    if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) return;
    
    // Parallax effect on orbs
    gsap.to('.orb-1', {
      y: -100,
      scrollTrigger: {
        trigger: '.hero-section',
        start: 'top top',
        end: 'bottom top',
        scrub: 1,
      },
    });
    
    gsap.to('.orb-2', {
      y: -50,
      x: 50,
      scrollTrigger: {
        trigger: '.hero-section',
        start: 'top top',
        end: 'bottom top',
        scrub: 1,
      },
    });
  };
  
  // Run hero animations quickly, defer parallax to reduce reflows
  if ('requestIdleCallback' in window) {
    requestIdleCallback(initHeroAnimations, { timeout: 500 });
    requestIdleCallback(initParallax, { timeout: 2000 });
  } else {
    setTimeout(initHeroAnimations, 100);
    setTimeout(initParallax, 1000);
  }
</script>

<style>
  /* Prevent CLS by pre-allocating space and using will-change */
  .hero-badge,
  .hero-title,
  .hero-subtitle,
  .hero-trust {
    will-change: transform;
    /* Don't set will-change: opacity as it can cause CLS, let GSAP handle it */
  }
  
  /* Fast CSS fade-in for hero laptop - improves LCP while keeping visual effect */
  @keyframes heroFadeIn {
    from {
      opacity: 0;
      transform: scale(0.95);
    }
    to {
      opacity: 1;
      transform: scale(1);
    }
  }

  .hero-visual {
    animation: heroFadeIn 0.8s ease-out forwards;
    will-change: transform, opacity;
  }

  /* Respect user preferences */
  @media (prefers-reduced-motion: reduce) {
    .hero-visual {
      animation: none;
    }
  }

  .orb-1 {
    top: 10%;
    left: 60%;
    animation: float 15s ease-in-out infinite;
    will-change: transform;
  }
  
  .orb-2 {
    top: 50%;
    left: 20%;
    animation: float 12s ease-in-out infinite reverse;
    will-change: transform;
  }
  
  .orb-3 {
    bottom: 20%;
    right: 10%;
    animation: float 10s ease-in-out infinite;
    will-change: transform;
  }
  
  .particle {
    animation: particleFloat linear infinite;
    will-change: transform, opacity;
  }
  
  @keyframes particleFloat {
    0%, 100% {
      transform: translateY(0) translateX(0);
      opacity: 0;
    }
    10% {
      opacity: 1;
    }
    90% {
      opacity: 1;
    }
    100% {
      transform: translateY(-100dvh) translateX(20px);
      opacity: 0;
    }
  }
  
  .laptop-container {
    transform-style: preserve-3d;
  }
  
  .scroll-indicator {
    animation: fadeInUpScroll 1s ease 2s forwards;
    opacity: 0;
  }
  
  .hero-cta {
    /* Removed opacity: 0 to improve LCP - buttons visible immediately */
  }
  
  @keyframes fadeInUpSimple {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateX(-50%) translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }
  }
  @keyframes fadeInUpScroll {
    from {
      opacity: 0;
      transform: translateX(-50%) translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateX(0) translateY(0);
    }
  }
</style>
